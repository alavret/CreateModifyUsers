# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "Email —É–∂–µ –∑–∞–Ω—è—Ç"

## –î–∞—Ç–∞: 15 –æ–∫—Ç—è–±—Ä—è 2025

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ API –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—â–∏—Ö —è—â–∏–∫–æ–≤, –∫–æ–≥–¥–∞ email –∞–¥—Ä–µ—Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

## –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏

### 1. Email –∞–¥—Ä–µ—Å —É–∂–µ –∑–∞–Ω—è—Ç (`passport_email_taken`)

**–§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏ –æ—Ç API:**
```json
{
    "code": 6,
    "message": "passport_email_taken",
    "details": [...]
}
```

**–ó–Ω–∞—á–µ–Ω–∏–µ:**
- **–ö–æ–¥**: 6
- **–°–æ–æ–±—â–µ–Ω–∏–µ**: `passport_email_taken`
- **–ü—Ä–∏—á–∏–Ω–∞**: Email –∞–¥—Ä–µ—Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ —è—â–∏–∫–æ–º)

### 2. –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω (`Unauthorized`)

**–§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏ –æ—Ç API:**
```json
{
    "message": "Unauthorized"
}
```

**–ó–Ω–∞—á–µ–Ω–∏–µ:**
- **–°–æ–æ–±—â–µ–Ω–∏–µ**: `Unauthorized`
- **–ü—Ä–∏—á–∏–Ω–∞**: OAuth —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –∏—Å—Ç–µ–∫ –∏–ª–∏ –æ—Ç–æ–∑–≤–∞–Ω

### 3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ (`No required scope`)

**–§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏ –æ—Ç API:**
```json
{
    "message": "No required scope"
}
```

**–ó–Ω–∞—á–µ–Ω–∏–µ:**
- **–°–æ–æ–±—â–µ–Ω–∏–µ**: `No required scope`
- **–ü—Ä–∏—á–∏–Ω–∞**: –£ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–∏—Ö —è—â–∏–∫–æ–≤
- **–¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞**: `ya360_admin:mail_write_shared_mailbox_inventory`

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏—è create_shared_mailbox_by_api() (—Å—Ç—Ä–æ–∫–∞ 2138-2183)

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ JSON –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
try:
    error_data = response.json()
    error_message = error_data.get('message', '')
    
    # 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "email —É–∂–µ –∑–∞–Ω—è—Ç"
    if error_message == 'passport_email_taken':
        logger.error(f"–û—à–∏–±–∫–∞: Email –∞–¥—Ä–µ—Å '{api_data['email']}' —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.")
        logger.error(f"–û–±—â–∏–π —è—â–∏–∫ '{api_data['email']}' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - Email –∞–¥—Ä–µ—Å –∑–∞–Ω—è—Ç.")
        response_data = {
            'error': 'Email –∞–¥—Ä–µ—Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
            'error_code': error_data.get('code'),
            'email': api_data['email'],
            'status_code': response.status_code
        }
        break  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    
    # 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "–Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"
    elif error_message == 'Unauthorized':
        logger.error("–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω.")
        logger.error(f"–û–±—â–∏–π —è—â–∏–∫ '{api_data['email']}' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω.")
        response_data = {
            'error': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω',
            'error_code': error_data.get('code'),
            'email': api_data['email'],
            'status_code': response.status_code
        }
        break  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    
    # 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤"
    elif error_message == 'No required scope':
        logger.error("–û—à–∏–±–∫–∞: –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞.")
        logger.error("–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞:")
        logger.error(" - ya360_admin:mail_write_shared_mailbox_inventory")
        logger.error("–≤ –∫–æ–Ω—Å–æ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ API 360 (oauth.yandex.ru).")
        logger.error(f"–û–±—â–∏–π —è—â–∏–∫ '{api_data['email']}' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞.")
        response_data = {
            'error': '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞',
            'error_code': error_data.get('code'),
            'email': api_data['email'],
            'status_code': response.status_code
        }
        break  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        
except (json.JSONDecodeError, ValueError):
    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
    pass
```

## –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ API:
1. –í—ã–≤–æ–¥–∏–ª–æ—Å—å –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
2. –î–µ–ª–∞–ª–∏—Å—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (–¥–æ 3 —Ä–∞–∑)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å —è—â–∏–∫ —Å —É–∂–µ –∑–∞–Ω—è—Ç—ã–º email:
- –î–µ–ª–∞–ª–∏—Å—å –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –≤ —á–µ–º –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–∏ –æ—à–∏–±–∫–µ `passport_email_taken`:
1. ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
2. ‚úÖ –í—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
3. ‚úÖ **–ù–ï –¥–µ–ª–∞—é—Ç—Å—è** –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (–±–µ—Å–ø–æ–ª–µ–∑–Ω—ã)
4. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –¥–µ—Ç–∞–ª—è–º–∏

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### 1. Email –∞–¥—Ä–µ—Å —É–∂–µ –∑–∞–Ω—è—Ç

**–í –ª–æ–≥–∞—Ö:**
```
ERROR: –û—à–∏–±–∫–∞: Email –∞–¥—Ä–µ—Å 'support@company.ru' —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
ERROR: –û–±—â–∏–π —è—â–∏–∫ 'support@company.ru' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - Email –∞–¥—Ä–µ—Å –∑–∞–Ω—è—Ç.
```

**–í –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    'error': 'Email –∞–¥—Ä–µ—Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
    'error_code': 6,
    'email': 'support@company.ru',
    'status_code': 400
}
```

### 2. –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω

**–í –ª–æ–≥–∞—Ö:**
```
ERROR: –û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω.
ERROR: –û–±—â–∏–π —è—â–∏–∫ 'support@company.ru' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω.
```

**–í –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    'error': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω',
    'error_code': None,
    'email': 'support@company.ru',
    'status_code': 401
}
```

### 3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤

**–í –ª–æ–≥–∞—Ö:**
```
ERROR: –û—à–∏–±–∫–∞: –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞.
ERROR: –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞:
ERROR:  - ya360_admin:mail_write_shared_mailbox_inventory
ERROR: –≤ –∫–æ–Ω—Å–æ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ API 360 (oauth.yandex.ru).
ERROR: –û–±—â–∏–π —è—â–∏–∫ 'support@company.ru' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞.
```

**–í –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```python
{
    'error': '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—â–µ–≥–æ —è—â–∏–∫–∞',
    'error_code': None,
    'email': 'support@company.ru',
    'status_code': 403
}
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

### –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ `shared.csv` —É–∫–∞–∑–∞–Ω email, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –∑–∞–Ω—è—Ç:

```csv
email;name;description
support@company.ru;Support;–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
info@company.ru;Information;–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
```
----------------------------------------------------------------------------------------------------
–ò–º–ø–æ—Ä—Ç –æ–±—â–∏—Ö —è—â–∏–∫–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ shared.csv
----------------------------------------------------------------------------------------------------
–§–∞–∑–∞ 1: –ß—Ç–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω. –ù–∞–π–¥–µ–Ω–æ 2 –æ–±—â–∏—Ö —è—â–∏–∫–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è.
----------------------------------------------------------------------------------------------------
–§–∞–∑–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–∏—Ö —è—â–∏–∫–æ–≤
----------------------------------------------------------------------------------------------------
–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ —è—â–∏–∫–∞ support@company.ru (—Å—Ç—Ä–æ–∫–∞ 2)...
–û—à–∏–±–∫–∞: Email –∞–¥—Ä–µ—Å 'support@company.ru' —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
–û–±—â–∏–π —è—â–∏–∫ 'support@company.ru' –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω - –∞–¥—Ä–µ—Å –∑–∞–Ω—è—Ç.

–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–≥–æ —è—â–∏–∫–∞ info@company.ru (—Å—Ç—Ä–æ–∫–∞ 3)...
–£—Å–ø–µ—Ö - –æ–±—â–∏–π —è—â–∏–∫ 'info@company.ru' ('Information') —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ.
----------------------------------------------------------------------------------------------------
–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
----------------------------------------------------------------------------------------------------
–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 2
–£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ: 1
–û—à–∏–±–æ–∫: 1
----------------------------------------------------------------------------------------------------
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** - –ø—Ä–∏ –æ—à–∏–±–∫–µ `passport_email_taken` —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —è—â–∏–∫—É
2. **–ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ email –∑–∞–Ω—è—Ç
3. **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞** - –æ—Å—Ç–∞–ª—å–Ω—ã–µ —è—â–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
4. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—à–∏–±–∫–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∏—Ç–æ–≥–∞—Ö

## –î—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏

–§—É–Ω–∫—Ü–∏—è —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

- **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏** - –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- **Timeout –æ—à–∏–±–∫–∏** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- **500** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (—Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏)
- **–î—Ä—É–≥–∏–µ 4xx** - –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (—Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏, –µ—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –û—à–∏–±–∫–∏ `Unauthorized` –∏ `No required scope` —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:

```python
# –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
if error_message == 'passport_email_taken':
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ email —É–∂–µ –∑–∞–Ω—è—Ç ...
    break
elif error_message == 'Unauthorized':
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω ...
    break
elif error_message == 'No required scope':
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ ...
    break

# –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏:
elif error_message == 'invalid_email_format':
    logger.error(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email –∞–¥—Ä–µ—Å–∞ '{api_data['email']}'")
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
    break

elif error_message == 'quota_exceeded':
    logger.error(f"–ü—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—â–∏–∫–æ–≤ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏")
    # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
    break
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫  
‚úÖ **–ù–µ—Ç –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** - —ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API  
‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –ª–µ–≥–∫–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ  
‚úÖ **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã** - –æ–¥–∏–Ω –Ω–µ—É–¥–∞—á–Ω—ã–π —è—â–∏–∫ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ—Å—å –∏–º–ø–æ—Ä—Ç  
‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –≤ –ª–æ–≥–∞—Ö –≤—Å—è –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è  
‚úÖ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é** - –¥–ª—è –æ—à–∏–±–æ–∫ –ø—Ä–∞–≤ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —à–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Email –∑–∞–Ω—è—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è**: –í –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `user@company.ru`

**–§–∞–π–ª** `test_taken.csv`:
```csv
email;name;description
user@company.ru;User Mailbox;–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —è—â–∏–∫ —Å –∑–∞–Ω—è—Ç—ã–º email
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- üìù –°–æ–æ–±—â–µ–Ω–∏–µ: "Email –∞–¥—Ä–µ—Å 'user@company.ru' —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
- üîÅ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ù–ï –¥–µ–ª–∞—é—Ç—Å—è

### –¢–µ—Å—Ç 2: Email –∑–∞–Ω—è—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –æ–±—â–∏–º —è—â–∏–∫–æ–º

**–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è**: –í –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —É–∂–µ –µ—Å—Ç—å –æ–±—â–∏–π —è—â–∏–∫ `support@company.ru`

**–§–∞–π–ª** `test_taken2.csv`:
```csv
email;name;description
support@company.ru;Support New;–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- üìù –°–æ–æ–±—â–µ–Ω–∏–µ: "Email –∞–¥—Ä–µ—Å 'support@company.ru' —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
- üîÅ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ù–ï –¥–µ–ª–∞—é—Ç—Å—è

### –¢–µ—Å—Ç 3: –°–º–µ—à–∞–Ω–Ω—ã–π —Ñ–∞–π–ª (–∑–∞–Ω—è—Ç—ã–µ –∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ email)

**–§–∞–π–ª** `test_mixed.csv`:
```csv
email;name;description
existing@company.ru;Existing;–ó–∞–Ω—è—Ç
new1@company.ru;New One;–°–≤–æ–±–æ–¥–µ–Ω
new2@company.ru;New Two;–°–≤–æ–±–æ–¥–µ–Ω
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚ùå `existing@company.ru` - –æ—à–∏–±–∫–∞ (–∞–¥—Ä–µ—Å –∑–∞–Ω—è—Ç)
- ‚úÖ `new1@company.ru` - —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ `new2@company.ru` - —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ: 2, –û—à–∏–±–æ–∫: 1

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ –û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫  
‚úÖ Graceful degradation - –µ—Å–ª–∏ JSON –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞  

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–¥–∞
```bash
python3 -m py_compile add_users.py
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Exit code 0 (–Ω–µ—Ç –æ—à–∏–±–æ–∫)

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –æ–±—â–∏–π —è—â–∏–∫ —Å email `test@domain.ru`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π —è—â–∏–∫ —Å —Ç–µ–º –∂–µ email —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–Ω—è—Ç–æ–º –∞–¥—Ä–µ—Å–µ
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ù–ï –¥–µ–ª–∞—é—Ç—Å—è

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

–ò–∑–º–µ–Ω–µ–Ω:
- `/Users/alavret/Documents/GitHub/CreateModifyUsers/add_users.py` (—Ñ—É–Ω–∫—Ü–∏—è `create_shared_mailbox_by_api`)

–°–æ–∑–¥–∞–Ω:
- `/Users/alavret/Documents/GitHub/CreateModifyUsers/ERROR_HANDLING_UPDATE.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

## –í–µ—Ä—Å–∏—è

- **–í–µ—Ä—Å–∏—è –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π**: 1.1.0
- **–í–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**: 1.1.1
- **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 15 –æ–∫—Ç—è–±—Ä—è 2025

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û—à–∏–±–∫–∞ `passport_email_taken` —è–≤–ª—è–µ—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–π –¥–ª—è API Yandex 360
- –ö–æ–¥ –æ—à–∏–±–∫–∏ `6` –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –ø–æ–ª–µ `message`
- –ï—Å–ª–∏ API –∏–∑–º–µ–Ω–∏—Ç —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ email –∞–¥—Ä–µ—Å–∞ —Å–≤–æ–±–æ–¥–Ω—ã
2. **–ü—Ä–∏ –æ—à–∏–±–∫–µ** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —è—â–∏–∫–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
3. **–î—É–±–ª–∏–∫–∞—Ç—ã** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–Ω—è—Ç–æ—Å—Ç—å –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Ç–æ–ª—å–∫–æ –≤ —Å–∞–º–æ–º —Ñ–∞–π–ª–µ
4. **–õ–æ–≥–∏** - –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `add_users.log` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–ó–∞–ø—Ä–æ—Å**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ passport_email_taken  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

