# Импорт общих ящиков - Быстрый старт

## Шаг 1: Настройте .env (опционально)

Если хотите использовать другое имя файла вместо `shared.csv`, добавьте в `.env`:

```bash
SHARED_MAILBOXES_FILE=my_mailboxes.csv
```

По умолчанию используется `shared.csv`.

## Шаг 2: Подготовьте файл с данными

Создайте файл (например, `shared.csv`) в папке с программой со следующим содержимым:

```csv
email;name;description
support;Support Team;Общий ящик службы поддержки
info;Information;Информационный ящик
sales;Sales Department;Ящик отдела продаж
```

**Важно:**
- Разделитель - точка с запятой (`;`)
- Первая строка - заголовки (`email;name;description`)
- Email может быть `alias` или `alias@domain.com`
- Строки начинающиеся с `#` пропускаются

## Шаг 3: Проверьте настройки в .env

Убедитесь, что в файле `.env` указаны:

```bash
OAUTH_TOKEN=your_oauth_token
ORG_ID=your_org_id
EMAIL_DOMAIN=your-domain.com           # ВАЖНО: Укажите ОСНОВНОЙ (по умолчанию) домен организации!
SHARED_MAILBOXES_FILE=shared.csv       # Опционально, по умолчанию shared.csv
```

> [!IMPORTANT]
> **Критически важно для EMAIL_DOMAIN:**
> - Укажите **основной (по умолчанию) домен** вашей организации Yandex 360
> - Проверить его можно в консоли администрирования: admin.yandex.ru → "Домены" → домен с меткой "Основной"
> - Общие почтовые ящики могут быть созданы **только в основном домене** организации
> - Неправильное указание домена приведет к ошибке `invalid_data`

## Шаг 4: Запустите импорт

### Вариант A: Через меню программы

1. Запустите программу:
   ```bash
   python add_users.py
   ```

2. Выберите пункт `7`:
   ```
   7. Импортировать общие ящики из файла.
   ```

3. Нажмите Enter (для использования файла по умолчанию `shared.csv`)

4. Подтвердите импорт: введите `да`

### Вариант B: Из кода

```python
from add_users import get_settings, import_shared_mailboxes_from_file

settings = get_settings()
import_shared_mailboxes_from_file(settings, "shared.csv")
```

## Примеры форматов email

### Только алиас (добавится домен из EMAIL_DOMAIN):
```csv
email;name;description
support;Support;Поддержка
```
→ Будет создан: `support@your-domain.com`

### Полный email:
```csv
email;name;description
support@company.com;Support;Поддержка
```
→ Будет создан: `support@company.com`

### С комментариями:
```csv
email;name;description
support;Support;Основной ящик
# test;Test;Временно отключен
info;Info;Информация
```
→ Будет создано 2 ящика (test пропущен)

## Результат выполнения

При успешном импорте вы увидите:

```
----------------------------------------------------------------------------------------------------
Импорт общих ящиков из файла shared.csv
----------------------------------------------------------------------------------------------------
Фаза 1: Чтение и валидация файла
Файл успешно прочитан. Найдено 3 общих ящиков для создания.
----------------------------------------------------------------------------------------------------
Фаза 2: Создание общих ящиков
----------------------------------------------------------------------------------------------------
Создание общего ящика support (строка 2)...
Успех - общий ящик 'support@domain.com' ('Support Team') создан успешно.
Создание общего ящика info (строка 3)...
Успех - общий ящик 'info@domain.com' ('Information') создан успешно.
Создание общего ящика sales (строка 4)...
Успех - общий ящик 'sales@domain.com' ('Sales Department') создан успешно.
----------------------------------------------------------------------------------------------------
Импорт завершен
----------------------------------------------------------------------------------------------------
Всего обработано: 3
Успешно создано: 3
Ошибок: 0
----------------------------------------------------------------------------------------------------
```

## Устранение ошибок

### Ошибка: "Некорректный email"

**Причина:** Email адрес имеет неправильный формат

**Решение:** 
- Используйте только буквы, цифры, точки, дефисы и подчеркивания
- Алиас должен начинаться и заканчиваться буквой или цифрой

### Ошибка: "Дублирующийся email"

**Причина:** В файле несколько раз указан один и тот же email

**Решение:** Удалите дубликаты из файла

### Ошибка: "Файл не найден"

**Причина:** Файл shared.csv отсутствует или указан неверный путь

**Решение:** Создайте файл shared.csv в папке с программой

### Ошибка: "Неверные заголовки"

**Причина:** Первая строка файла не соответствует требуемому формату

**Решение:** Убедитесь, что первая строка: `email;name;description`

## Тестовый режим (DRY_RUN)

Для проверки файла без реального создания ящиков:

1. В файле `.env` установите:
   ```bash
   DRY_RUN=true
   ```

2. Запустите импорт - будет выполнена только валидация

3. После проверки верните:
   ```bash
   DRY_RUN=false
   ```

## Дополнительная информация

Полная документация: [SHARED_MAILBOXES_README.md](SHARED_MAILBOXES_README.md)

