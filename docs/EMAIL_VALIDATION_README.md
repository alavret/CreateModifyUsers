# Валидация Email адресов в скрипте добавления пользователей

## Описание

Добавлена функция проверки email адресов с комплексной валидацией согласно стандартам RFC.

## Функция validate_email

```python
def validate_email(email: str) -> tuple[bool, str]:
```

### Параметры:
- `email` (str): Email адрес для проверки

### Возвращает:
- `tuple[bool, str]`: (результат проверки, сообщение об ошибке или "OK")

## Правила валидации

### ✅ Валидные email адреса:
- `user@example.com` - базовый формат
- `test.user@domain.org` - с точкой в локальной части
- `user123@test-domain.co.uk` - с цифрами и дефисом
- `user_name@example.com` - с подчеркиванием
- `user-name@example.com` - с дефисом
- `user+tag@example.com` - с плюсом
- `user@sub.domain.com` - с поддоменом

### ❌ Невалидные email адреса:
- Пустые строки или только пробелы
- Отсутствие символа `@`
- Множественные символы `@`
- Последовательные точки (`..`)
- Точки в начале или конце локальной части/домена
- Пробелы в адресе
- Слишком короткие TLD (менее 2 символов)
- Локальная часть длиннее 64 символов
- Домен длиннее 253 символов

## Технические детали

### Проверки выполняемые функцией:

1. **Базовая проверка:**
   - Не пустая строка
   - Удаление пробелов в начале и конце

2. **Структурная проверка:**
   - Наличие символа `@`
   - Единственный символ `@`
   - Разделение на локальную часть и домен

3. **Проверка локальной части:**
   - Не пустая
   - Длина не более 64 символов
   - Не начинается и не заканчивается точкой
   - Нет последовательных точек

4. **Проверка домена:**
   - Не пустой
   - Длина не более 253 символов
   - Не начинается и не заканчивается точкой
   - Нет последовательных точек

5. **Регулярное выражение:**
   ```regex
   ^[a-zA-Z0-9]([a-zA-Z0-9._-]*[a-zA-Z0-9])?@[a-zA-Z0-9]([a-zA-Z0-9.-]*[a-zA-Z0-9])?(\.[a-zA-Z]{2,})+$
   ```

## Интеграция в код

### 1. Проверка в процессе валидации данных:
```python
temp_personal_email = element["personal_email"]
if temp_personal_email:
    check_email, email_value = validate_email(temp_personal_email)
    if not check_email:
        stop_adding = True
        logger.error(f'Строка #{line_number}. Некорректный личный email _"{temp_personal_email}"_. Отмена добавления пользователя.')
    else:
        entry["personal_email"] = email_value
```

### 2. Добавление в структуру пользователя:
```python
if u.get('personal_email',''):
    user["contacts"].append({
        "type": "email",
        "value": u.get('personal_email'),
        'label': 'Personal'
    })
```

## Поддерживаемые поля CSV

В CSV файле теперь поддерживается поле `personal_email`:

```csv
login;first_name;last_name;middle_name;password;password_change_required;language;gender;birthday;position;work_phone;mobile_phone;personal_email
user1;Иван;Иванов;Иванович;Password123!;true;ru;male;1990-01-01;Менеджер;+7(495)123-45-67;+7(916)123-45-67;ivan@example.com
```

## Тестирование

Для тестирования функции создан файл `test_email_validation.py` с комплексными тестами:

- Валидные email адреса различных форматов
- Невалидные email адреса с различными ошибками
- Граничные случаи
- Проверка длины полей
- Проверка специальных символов

## Файлы

- `add_modify_users.py` - основная функция `validate_email()` и интеграция
- `test_email_validation.py` - тесты для проверки функции
- `env.example` - обновленный пример конфигурации
- `EMAIL_VALIDATION_README.md` - данная документация

## Использование

1. Добавьте поле `personal_email` в CSV файл с пользователями
2. Запустите скрипт - валидация email будет выполняться автоматически
3. При некорректном email добавление пользователя будет отменено с записью в лог
